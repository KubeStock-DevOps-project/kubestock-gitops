---
# ArgoCD Configuration
# Custom settings for KubeStock deployment
apiVersion: v1
kind: ConfigMap
metadata:
  name: argocd-cm
  namespace: argocd
  labels:
    app.kubernetes.io/name: argocd-cm
    app.kubernetes.io/part-of: argocd
data:
  # Repository configuration
  repositories: |
    - url: https://github.com/KubeStock-DevOps-project/kubestock-gitops.git
      name: kubestock-gitops
      type: git

  # Resource customizations for health checks
  resource.customizations: |
    networking.k8s.io/Ingress:
      health.lua: |
        hs = {}
        hs.status = "Healthy"
        return hs
    apps/StatefulSet:
      health.lua: |
        hs = {}
        if obj.status ~= nil then
          if obj.status.readyReplicas ~= nil then
            if obj.status.readyReplicas == obj.spec.replicas then
              hs.status = "Healthy"
              hs.message = "All replicas are ready"
              return hs
            end
          end
        end
        hs.status = "Progressing"
        hs.message = "Waiting for all replicas to be ready"
        return hs

  # Application controller settings
  application.instanceLabelKey: argocd.argoproj.io/instance

  # Kustomize build options
  kustomize.buildOptions: --load-restrictor LoadRestrictionsNone

  # Resource exclusions (ignore certain resources)
  resource.exclusions: |
    - apiGroups:
        - cilium.io
      kinds:
        - CiliumIdentity
      clusters:
        - "*"
    - apiGroups:
        - ""
      kinds:
        - Event
      clusters:
        - "*"
