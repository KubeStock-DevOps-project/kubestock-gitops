# =============================================================================
# Staging Overlay - kubestock-staging namespace
# =============================================================================
# Rolling Update Deployment Strategy
# Uses RDS PostgreSQL for database
# Uses specific SHA tags managed by CI/CD pipeline
# CORS: * (wildcard for staging)
# =============================================================================
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: kubestock-staging

resources:
- ../../base/services/ms-product/
- ../../base/services/ms-inventory/
- ../../base/services/ms-supplier/
- ../../base/services/ms-order-management/
- ../../base/services/ms-identity/
- ../../base/services/frontend/
- namespace.yaml
- external-secrets.yaml

labels:
- pairs:
    environment: staging

# Image tags - using specific SHA tags (updated by CI/CD)
images:
- name: 478468757808.dkr.ecr.ap-south-1.amazonaws.com/kubestock/web
  newTag: 6b29066
- name: 478468757808.dkr.ecr.ap-south-1.amazonaws.com/kubestock/ms-identity
  newTag: 85c3bc2
- name: 478468757808.dkr.ecr.ap-south-1.amazonaws.com/kubestock/ms-inventory
  newTag: 6b29066
- name: 478468757808.dkr.ecr.ap-south-1.amazonaws.com/kubestock/ms-order-management
  newTag: 6b29066
- name: 478468757808.dkr.ecr.ap-south-1.amazonaws.com/kubestock/ms-product
  newTag: 64d1ed3
- name: 478468757808.dkr.ecr.ap-south-1.amazonaws.com/kubestock/ms-supplier
  newTag: 6b29066

# Patches for staging-specific configuration
# HPA manages scaling with minReplicas=1 (base default)
# No replicas patch needed - HPA controls pod count
