# =============================================================================
# Production Overlay - kubestock-production namespace
# =============================================================================
# Rolling Update Deployment Strategy
# Uses RDS PostgreSQL for database
# Domain: kubestock.dpiyumal.me
# =============================================================================
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: kubestock-production

resources:
  - ../../base/services/ms-product/
  - ../../base/services/ms-inventory/
  - ../../base/services/ms-supplier/
  - ../../base/services/ms-order-management/
  - ../../base/services/ms-identity/
  - ../../base/services/frontend/
  - namespace.yaml
  - external-secrets.yaml

labels:
  - pairs:
      environment: production
    includeSelectors: false

# Production replicas patch
patches:
  # Set replicas to 2 for all deployments
  - patch: |-
      - op: replace
        path: /spec/replicas
        value: 2
    target:
      kind: Deployment
  
  # No frontend-specific environment variables needed for production
  # All configuration is handled at runtime via window.location.origin

# Image tags - managed by CI/CD pipeline
images:
  - name: 478468757808.dkr.ecr.ap-south-1.amazonaws.com/kubestock/web
    newTag: 0a4b35b
  - name: 478468757808.dkr.ecr.ap-south-1.amazonaws.com/kubestock/ms-identity
    newTag: 0a4b35b
  - name: 478468757808.dkr.ecr.ap-south-1.amazonaws.com/kubestock/ms-inventory
    newTag: 0a4b35b
  - name: 478468757808.dkr.ecr.ap-south-1.amazonaws.com/kubestock/ms-order-management
    newTag: 0a4b35b
  - name: 478468757808.dkr.ecr.ap-south-1.amazonaws.com/kubestock/ms-product
    newTag: 0a4b35b
  - name: 478468757808.dkr.ecr.ap-south-1.amazonaws.com/kubestock/ms-supplier
    newTag: 0a4b35b
