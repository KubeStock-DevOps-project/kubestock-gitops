# =============================================================================
# Production Overlay - kubestock-production namespace
# =============================================================================
# Rolling Update Deployment Strategy
# Uses RDS PostgreSQL for database
# Domain: kubestock.dpiyumal.me
# =============================================================================
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: kubestock-production

resources:
  - ../../base/services/ms-product/
  - ../../base/services/ms-inventory/
  - ../../base/services/ms-supplier/
  - ../../base/services/ms-order-management/
  - ../../base/services/ms-identity/
  - ../../base/services/frontend/
  - namespace.yaml
  - external-secrets.yaml

labels:
  - pairs:
      environment: production
    includeSelectors: false

# Production HPA and replica configuration
# HPA manages scaling, we set minReplicas=2 for production HA
patches:
  # Set minReplicas to 2 for all HPAs in production for HA
  - patch: |-
      - op: replace
        path: /spec/minReplicas
        value: 2
    target:
      kind: HorizontalPodAutoscaler

# Image tags - managed by CI/CD pipeline
images:
  - name: 478468757808.dkr.ecr.ap-south-1.amazonaws.com/kubestock/web
    newTag: 18503ab
  - name: 478468757808.dkr.ecr.ap-south-1.amazonaws.com/kubestock/ms-identity
    newTag: 18503ab
  - name: 478468757808.dkr.ecr.ap-south-1.amazonaws.com/kubestock/ms-inventory
    newTag: 561340d
  - name: 478468757808.dkr.ecr.ap-south-1.amazonaws.com/kubestock/ms-order-management
    newTag: 6b29066
  - name: 478468757808.dkr.ecr.ap-south-1.amazonaws.com/kubestock/ms-product
    newTag: 18503ab
  - name: 478468757808.dkr.ecr.ap-south-1.amazonaws.com/kubestock/ms-supplier
    newTag: 18503ab
