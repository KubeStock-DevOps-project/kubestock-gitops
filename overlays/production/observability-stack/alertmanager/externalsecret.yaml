# =============================================================================
# Alertmanager - ExternalSecret for Slack Webhooks
# =============================================================================
# This syncs Slack webhook URLs from AWS Secrets Manager to Kubernetes
#
# To populate the secret in AWS, run:
# aws secretsmanager put-secret-value \
#   --secret-id kubestock/production/alertmanager/slack \
#   --secret-string '{
#     "default-url": "https://hooks.slack.com/services/YOUR/DEFAULT/URL",
#     "critical-url": "https://hooks.slack.com/services/YOUR/CRITICAL/URL",
#     "warning-url": "https://hooks.slack.com/services/YOUR/WARNING/URL"
#   }'
# =============================================================================
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: alertmanager-slack-webhook
  labels:
    app: alertmanager
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: aws-secretsmanager
    kind: ClusterSecretStore
  target:
    name: alertmanager-slack-webhook
    creationPolicy: Owner
  data:
    - secretKey: default-url
      remoteRef:
        conversionStrategy: Default
        decodingStrategy: None
        key: kubestock-demo/production/alertmanager/slack
        metadataPolicy: None
        property: default-url
    - secretKey: critical-url
      remoteRef:
        conversionStrategy: Default
        decodingStrategy: None
        key: kubestock-demo/production/alertmanager/slack
        metadataPolicy: None
        property: critical-url
    - secretKey: warning-url
      remoteRef:
        conversionStrategy: Default
        decodingStrategy: None
        key: kubestock-demo/production/alertmanager/slack
        metadataPolicy: None
        property: warning-url
