# =============================================================================
# RBAC for Cross-Namespace Secret Access
# =============================================================================
# Allows External Secrets controller to read the aws-external-secrets-creds
# secret from the external-secrets namespace when processing ECRAuthorizationToken
# generators in other namespaces.
#
# Security Model:
# - AWS credentials exist ONLY in external-secrets namespace
# - ECRAuthorizationToken generators in app namespaces reference these credentials
# - Only the generated ECR tokens (expire in 12h) exist in app namespaces
# - No AWS credential replication across namespaces
# =============================================================================
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: external-secrets-ecr-credentials-reader
  namespace: external-secrets
  labels:
    app.kubernetes.io/name: external-secrets
    app.kubernetes.io/component: rbac
rules:
  - apiGroups: [""]
    resources: ["secrets"]
    resourceNames: ["aws-external-secrets-creds"]
    verbs: ["get"]
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: external-secrets-ecr-credentials-reader
  namespace: external-secrets
  labels:
    app.kubernetes.io/name: external-secrets
    app.kubernetes.io/component: rbac
subjects:
  - kind: ServiceAccount
    name: external-secrets
    namespace: external-secrets
roleRef:
  kind: Role
  name: external-secrets-ecr-credentials-reader
  apiGroup: rbac.authorization.k8s.io
